FROM node:18-alpine
WORKDIR /usr/app
COPY ./package*.json ./

# Install the npm dependencies
# TODO: remove --force and sort out underlying issues
RUN npm install --force

COPY . .

# Accept environment variables passed during the Docker build process
ARG AUTH0_CLIENT_SECRET
ARG ENV
ARG REACT_APP_API_1_URL
ARG REACT_APP_API_2_URL
ARG REACT_APP_AUTH0_AUDIENCE
ARG REACT_APP_AUTH0_CLIENT_ID
ARG REACT_APP_AUTH0_URL
ARG REACT_APP_PUBLIC_STRIPE_KEY
ARG REACT_APP_ROOT_URL

# Set the environment variables inside the container
ENV AUTH0_CLIENT_SECRET=$AUTH0_CLIENT_SECRET
ENV REACT_APP_API_1_URL=$REACT_APP_API_1_URL
ENV REACT_APP_API_2_URL=$REACT_APP_API_2_URL
ENV REACT_APP_AUTH0_AUDIENCE=$REACT_APP_AUTH0_AUDIENCE
ENV REACT_APP_AUTH0_CLIENT_ID=$REACT_APP_AUTH0_CLIENT_ID
ENV REACT_APP_AUTH0_URL=$REACT_APP_AUTH0_URL
ENV REACT_APP_PUBLIC_STRIPE_KEY=$REACT_APP_PUBLIC_STRIPE_KEY
ENV REACT_APP_ROOT_URL=$REACT_APP_ROOT_URL

# Expose the port the application will run on
EXPOSE 8080

# Start the client application
CMD ["npm", "run", "start"]
